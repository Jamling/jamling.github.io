<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<head>
  <meta charset="utf-8">
  <title>Jetpack Compose 01之环境配置</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="Android,Compose,Jetpack Compose 01之环境配置">
  <meta name="description" content="终于下定决心要开启Compose世界的大门了，如果是新建一个项目，应该不会遇到什么问题，然而要从一个旧的项目中引入compose，遇到的问题还是比较多的。在此特别记录一下主要的环境配置步骤及遇到的一些问题及解决方案。">
   

  <meta name="og:type" content="article">
  <meta name="og:site_name" content="Jamling's Blog and Project Site">
  <meta name="og:image" content="https://www.ieclipse.cn/image/logo.png">
  <meta name="og:title" content="Jetpack Compose 01之环境配置">
  <meta name="og:url" content="https://www.ieclipse.cn/2022/10/20/Android/jetpack-compose-env/">
  <meta name="og:description" content="终于下定决心要开启Compose世界的大门了，如果是新建一个项目，应该不会遇到什么问题，然而要从一个旧的项目中引入compose，遇到的问题还是比较多的。在此特别记录一下主要的环境配置步骤及遇到的一些问题及解决方案。">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="Jamling's Blog and Project Site">
  <meta name="twitter:image" content="https://www.ieclipse.cn/image/logo.png">
  <meta name="twitter:title" content="Jetpack Compose 01之环境配置">
  <meta name="twitter:creator" content="@JamlingLi">
  <meta name="twitter:description" content="终于下定决心要开启Compose世界的大门了，如果是新建一个项目，应该不会遇到什么问题，然而要从一个旧的项目中引入compose，遇到的问题还是比较多的。在此特别记录一下主要的环境配置步骤及遇到的一些问题及解决方案。">

  <!-- Canonical links -->
  <link rel="canonical" href="https://www.ieclipse.cn/en/2022/10/20/Android/jetpack-compose-env/index.html">
  <!-- Alternative links -->
  <!-- CSS and JS-->
  
<script src="//cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">


<script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<script src="//cdn.staticfile.org/sidr/2.2.1/jquery.sidr.min.js"></script>


<script src="/js/jquery.bootstrap-autohidingnavbar.min.js"></script>


<link rel="stylesheet" href="//cdn.staticfile.org/sidr/2.2.1/stylesheets/jquery.sidr.dark.min.css">


<link rel="stylesheet" href="//cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css">


<script src="//cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>


<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@2/distr/fira_code.css">


<script src="//cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>


<script src="//cdn.staticfile.org/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


<link rel="stylesheet" href="//cdn.staticfile.org/fancybox/2.1.5/jquery.fancybox.min.css">


<link rel="stylesheet" href="//cdn.staticfile.org/fancybox/2.1.5/helpers/jquery.fancybox-buttons.css">


<script src="//cdn.staticfile.org/fancybox/2.1.5/helpers/jquery.fancybox-buttons.js"></script>


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">


<link rel="stylesheet" href="/css/nova_font.css">


<link rel="stylesheet" href="/css/bs/nova.css">


<script src="//unpkg.com/leancloud-storage@4.13.2/dist/av-min.js"></script>


<script src="/js/leancloud.js"></script>


  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Jamling's Blog and Project Site" type="application/atom+xml">
  <link rel="shortcut icon" href="/image/favicon.ico" type="image/x-icon" />
  <script>
        lc.init({
          appId : 'C45xzaBLva5G5IfKxOwGXuVb-gzGzoHsz',
          appKey : 'QwGBjKlSYOBtjMa5aTGeO3cb',
          serverURL : 'https://lc.ieclipse.cn'
        }, {
          xid : '62a734864ac7fd757aa5100334f876d7',
          url : 'en/2022/10/20/Android/jetpack-compose-env/',
          title : 'Jetpack Compose 01之环境配置'
        }, {
          counterTable: '',
          commentTable: '',
          donateTable: ''
        });
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <!-- header -->
  <header id="body-header">
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top">
    <div class="container container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse_" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/en/" id="logo"><img src="/image/logo.png" height="50" alt="logo"></a>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
        <li><a href="/en/" class="main-nav">Home</a></li><li><a href="/en/p/" class="main-nav">Projects</a></li><li><a href="/en/categories/" class="main-nav">Category</a></li><li><a href="/en/archives/" class="main-nav">Archive</a></li><li><a href="/en/donate/" class="main-nav">Donate</a></li><li><a href="/en/about/" class="main-nav">About</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Language <span class="caret"></span></a>
            <ul class="dropdown-menu animated fadeInDown faster">
              <li><a href="/2022/10/20/Android/jetpack-compose-env/">简体中文</a></li>
              
              <li><a href="/en/2022/10/20/Android/jetpack-compose-env/">English</a></li>
              
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

  <!-- main -->
  
<div class="container container-fluid">
<div class="row">
  <div class="col-sx-12 col-sm-8 col-md-9 col-lg-9">
    
<article class="article post" itemscope="itemscope" itemtype="http://schema.org/Article">
  <header class="article-header">
    <div class="page-path"><span class="post-category"><span class="glyphicon glyphicon-folder-close" aria-hidden="true"></span>Path: <a class="category-item" href="/en/">Blog</a><a class="category-item" href="/en/categories/Android/">Android</a><a class="category-item" href="/en/categories/Android/Compose/">Compose</a><a class="category-item">Jetpack Compose 01之环境配置</a></span></div>
    <div class="divider"></div>
      <h1 class="article-title" itemprop="name headline">Jetpack Compose 01之环境配置</h1>
    <div class="post-header clearfix">
      <span class="post-date"><span class="hidden-xs icon nova-calendar">Post at: </span>
      <time datetime="2022-10-20T14:27:33.000Z" itemprop="datePublished"><time datetime="2022-10-20T14:27:33.000Z">2022-10-20</time></time>
      </span>
      
      <span class="post-share xxx-count" data-xid="62a734864ac7fd757aa5100334f876d7" data-title="Jetpack Compose 01之环境配置" data-url="en/2022/10/20/Android/jetpack-compose-env/">
        <a href="#share" class="icon nova-share">
          <span class="hidden-xs">Share</span><span class="jiathis_counter_style"></span>
        </a>
        <a href="#comment" class="icon nova-bubbles comment-count">
          <span class="count"></span><span class="hidden-xs">Comment</span>
        </a>
        <!--<a href="#like" class="icon nova-heart2-full"><span class="count" id="changyan_parti_unit"></span><span class="hidden-xs">Like</span></a>-->
        <a href="#" class="icon nova-eye view-count">
          <span class="count"></span><span class="hidden-xs">Views</span>
        </a>
      </span>
    </div>
    <div class="divider"></div>
    <meta content="2022-10-20T14:27:33.000Z" itemprop="datePublished">
  </header>
  <div class="article-content" itemprop="articleBody">
  
    <p>终于下定决心要开启Compose世界的大门了，如果是新建一个项目，应该不会遇到什么问题，然而要从一个旧的项目中引入compose，遇到的问题还是比较多的。在此特别记录一下主要的环境配置步骤及遇到的一些问题及解决方案。</p>
<h3 id="kotlin环境配置"><a href="#kotlin环境配置" class="headerlink" title="kotlin环境配置"></a>kotlin环境配置</h3><p>Compose目前只能使用Kotlin，之前对Kotlin只是初步的了解。不过项目中也使用了一点kotlin，所以基本的环境已有，百度的结果说开启compose世界的大门很简单，大概下面三个配置</p>
<p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code>buildFeatures &#123;
    compose true
&#125;

compileOptions &#123;
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
&#125;
kotlinOptions &#123;
    jvmTarget = &quot;1.8&quot;
&#125;

composeOptions &#123;
    kotlinCompilerExtensionVersion &#39;1.3.2&#39;
&#125;
</code></pre>
<p>然后现实很骨感，给我这么一个下马威</p>
<p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code>This version (x.x.x) of the Compose Compiler requires Kotlin version y.y.y but you appear to be using Kotlin version z.z.z which is not known to be compatible.  Please fix your configuration (or `suppressKotlinVersionCompatibilityCheck` but don&#39;t say I didn&#39;t warn you!).
</code></pre>
<p>应该是Kotlin版本太低了，升级到最新的1.7.20先升了再说，相应的依赖组件也升级到此对应版本，这个不知道什么原因，我只能使用1.6.0（不过最终仍然被我升级到了1.7.20）</p>
<h3 id="Gradle配置"><a href="#Gradle配置" class="headerlink" title="Gradle配置"></a>Gradle配置</h3><p>吃了之前的亏，我就新建了一个Compose Activity新项目，发现app&#x2F;build.gradle引入插件的方式变了，都看不见build-tool了，应该是新的方法，立马应用一波，结果</p>
<p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code>Plugin [id: &#39;com.android.application&#39;, version: &#39;7.2.0&#39;, apply: false] was not found in any of the following sources:
</code></pre>
<p>invalidate caches及restart及百度无果之后，发发现新建的项目settings.gradle有变化，添加了如下配置</p>
<p class="code-caption" data-lang="gradle" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code class="gradle">pluginManagement &#123; // 这是build工具组件的搜索仓库
    repositories &#123;
        gradlePluginPortal()
        google()
        mavenCentral()
    &#125;
&#125;
dependencyResolutionManagement &#123;
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories &#123; // 这是项目依赖组件的搜索仓库
        google()
        jcenter()
        mavenCentral()
        maven &#123; url &#39;https://jitpack.io&#39; &#125;
    &#125;
&#125;
</code></pre>
<p>终于sync成功了</p>
<h3 id="添加Compose依赖"><a href="#添加Compose依赖" class="headerlink" title="添加Compose依赖"></a>添加Compose依赖</h3><p class="code-caption" data-lang="gradle" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code class="gradle">dependencies &#123;
    // 这个是最基本的组件
    implementation &#39;androidx.compose.ui:ui:1.2.1&#39;
    // 工具支持比如预览
    implementation &#39;androidx.compose.ui:ui-tooling:1.2.1&#39;
    // 基础类的控件，比如按钮等
    implementation &#39;androidx.compose.foundation:foundation:1.2.1&#39;
    // MD，还有个MD3，不过还没有正式Release
    implementation &#39;androidx.compose.material:material:1.2.1&#39;
    // MD图标
    implementation &#39;androidx.compose.material:material-icons-core:1.2.1&#39;
    implementation &#39;androidx.compose.material:material-icons-extended:1.2.1&#39;
    // 集成Activity
    implementation &#39;androidx.activity:activity-compose:1.5.1&#39;
    // 集成ViewModels
    implementation &#39;androidx.lifecycle:lifecycle-viewmodel-compose:2.5.1&#39;

    // UI 测试
    androidTestImplementation &#39;androidx.compose.ui:ui-test-junit4:1.2.1&#39;
&#125;
</code></pre>
<p>又报类重复冲突</p>
<p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code>Duplicate class androidx.lifecycle.ViewModelLazy found in modules jetified-lifecycle-viewmodel-ktx-2.3.1-runtime (androidx.lifecycle:lifecycle-viewmodel-ktx:2.3.1.
</code></pre>
<p>升级组件，升级后还是报类似的错，依赖中把java及ktx的组件全加进去。类似的还是jetpack core组件，相同的解决方式。此问题修复</p>
<p>后来中途不知道做了什么操作，import中的 compose全部标红。gradle sync一直失败<br><code>Gradle sync failed: Sync failed: reason unknown</code><br>一度怀疑改错了什么，clean、invalidate及restart都都想放弃了。仔细对比之后发现修改应无问题才是，回过头去运行之前创建的新工程，发现也无法运行。<br><code>Unable to find Gradle tasks to build: [:].</code></p>
<p>详细的错误日志是这些看不懂的</p>
<p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p>

<pre><code>Could not initialize class com.jetbrains.cidr.lang.dfa.contextSensitive.OCSo
... 
Exception &#39;java.lang.NoClassDefFoundError: Could not initialize class com.jetbrain.
...
ClassNotFoundException: kotlin.reflect.jvm.KClassesJvm
</code></pre>
<p>这TM的就好办了，肯定是AS抽筯了，重新安装AS，问题解决。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>其实遇到的问题非常多，大约十几个，复杂一点的就上面几个，新的技术，建议还是参考官方新项目来搞，旧项目坑太多了，尤其是最后一条，太坑了，不过越是难，越有挑战性，遇到问题不要慌，冷静思考，沉着应对。相信总会解决的。</p>
<blockquote class="addlink">本文永久链接： [https://www.ieclipse.cn/2022/10/20/Android/jetpack-compose-env/](https://www.ieclipse.cn/2022/10/20/Android/jetpack-compose-env/) 未经允许，禁止转载，如有问题，请在我的博客原始页面提交评论。</blockquote>
  
  </div>

  
<script src="/js/decrypt.min.js"></script>

  <footer class="article-footer">
    <time class="article-footer-updated" datetime="2022-10-20T15:28:16.677Z" itemprop="dateModified">
    Last updated: 2022-10-20
    </time>
    <span itemprop="author publisher" itemscope="itemscope" itemtype="http://schema.org/Organization">
      <meta content="https://www.ieclipse.cn" itemprop="url">
      <meta content="Jamling's Blog and Project Site" itemprop="name">
      <meta content="/image/logo.png" itemprop="logo">
    </span>
    
<a id="share"></a>
<div class="social-share"></div>
<script>
with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js'];
</script>


  </footer>
</article>

<div class="page-footer">
  <nav><ul class="pager"><li class="previous"><a href="/en/2022/10/22/Android/fwk/android-13-zygote-init/"><span aria-hidden="true">&larr;</span><span class="hidden-xs">Prev</span></a></li><li class="next"><a href="/en/2022/10/17/Web/hexo-your-resume/"><span aria-hidden="true">&rarr;</span><span class="hidden-xs">Next</span></a></li></ul></nav>
  
<!-- Button trigger modal -->
<blockquote class="donate"><!--
  <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#DonateModal">
    Donate
  </button>-->
  <p>
  <a href="#" role="button" data-toggle="modal" data-target="#DonateModal">
  <img src="/image/donate_button.png" alt="donate">
  <span>Dear reader, if you feel this good, could you rewark me a `bread` as awark? Thank you very much~</span></a>
  </p>
</blockquote>
<!-- Modal -->
<div class="modal fade" id="DonateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <span class="modal-title" id="myModalLabel">Donate</span>
      </div>
      <div class="modal-body"><!--
        <table>
        <thead>
          <th class="text-center">支付宝</th>
          <th class="text-center">微信支付</th>
        </thead>
        <tr>
          <td><img src="/image/donate_alipay.png" alt="使用支付宝扫码打赏" class="img-rounded donate" width="200" height="200"></td>
          <td><img src="/image/donate_wechat.png" alt="使用微信扫码打赏" class="img-rounded donate" width="200" height="200"></td>
        </tr>
        </table>-->
        <div class="container-fluid">
        <div class="row">
        <div class="col-md-6">
          <div class="text-center">
            <span style="display:block;">支付宝</span>
            <img src="/image/donate_alipay.png" alt="使用支付宝扫码打赏" class="donate" />
          </div>
        </div>
        <div class="col-md-6">
          <div class="text-center">
            <span style="display:block;">微信支付</span>
            <img src="/image/donate_wechat.png" alt="使用微信扫码打赏" class="donate" />
          </div>
        </div>
        </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  <a id="comment"></a>

<script src="//unpkg.com/valine/dist/Valine.min.js">
</script>
<!--PC和WAP自适应版-->
<div id="vcomments" data-sid="62a734864ac7fd757aa5100334f876d7" ></div>
<script>
    new Valine({
        av: AV,
        el: '#vcomments',
        appId: 'C45xzaBLva5G5IfKxOwGXuVb-gzGzoHsz',
        appKey: 'QwGBjKlSYOBtjMa5aTGeO3cb',
        path: 'en/2022/10/20/Android/jetpack-compose-env/',
        recordIP: true,
        visitor: false
    })
</script>



</div>


    
  </div> <!-- end main column  -->
  <!-- aside -->
  <div class="col-sx-12 col-sm-4 col-md-3 col-lg-3">
    <aside>
      <div id="navbar-toc">
      <nav id="toc" class="hidden-print hidden-xs hidden-sm" data-spy="affix">
        <div class="toc-title"><a role="button" data-toggle="collapse" href="#toc-body" aria-expanded="true">
          Table Of Contents
        </a></div>
        <div id="toc-body" class="in">
        <ul class="nav toc-ul"><li><a href="#kotlin环境配置">kotlin环境配置</a></li><li><a href="#Gradle配置">Gradle配置</a></li><li><a href="#添加Compose依赖">添加Compose依赖</a></li><li><a href="#总结">总结</a></li></ul>
        </div>
      </nav>
</div>

      
    </aside>
  </div> <!-- end aside column  -->
</div> <!-- end row -->
</div> <!-- end container -->

  <!-- footer -->
  <footer id="body-footer">
  <div class="divider"></div>
  <div>&nbsp;</div>
  <div class="inner text-center">
    <div id="footer-copyright">
      &copy; 2022 <a href="https://www.ieclipse.cn" target="_blank">Jamling</a> powered by <a href="http://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Jamling/hexo-theme-nova" target="_blank">Nova</a><br>
      <!-- Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>. -->
    </div>
    <div>
      <a href="//beian.miit.gov.cn" target="_blank">苏ICP备15019510号</a>
    </div>
  </div>
</footer>

  <!-- fixed action bar -->
  
  <div class="fab hidden-print" style="bottom: 45px; right: 24px;">
  <!--
    <ul class="top-expand" id="top-expand">
      <li><a class="fab-item large red" href="#top"><i class="icon nova-top"></i></a></li>
      <li><a class="fab-item large yellow " href="//www.jiathis.com/share?uid=2064663" target="_blank"><i class="icon nova-share"></i></a></li>
    </ul>
    <a class="fab-item large red " onclick="$('#top-expand').toggle();">
      <i class="icon nova-list-ul"></i>
    </a>
    -->
    <a class="fab-item large red " href="#top">
      <i class="icon nova-top"></i>
    </a>
  </div>

  <!-- after footer, some 3rd script place here -->
    <script>
    var hljs_labels = {
        left: "Code",
        right: ":",
        copy: "Copy to clipboard"
    }
    </script>
    
<script src="/js/hljs.js"></script>

    
<script src="/js/script.js"></script>

    
    
<script>
  lc.countCounter({});

  lc.countComment({
    index: false
  });
</script>
</body>
</html>
